–Ø –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –¥–ª—è –≤–∞—Å –ø–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –∏–∑ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ññ17 –ø–æ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—é –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ASP.NET Core.

---

‚úÖ –ó–∞–¥–∞–Ω–∏–µ 5.1 ‚Äì –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

5.1.1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç ¬´–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ASP.NET Core¬ª

```bash
dotnet new webapp -n CinemaApp
cd CinemaApp
```

5.1.2. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ë–î –∏ –º–æ–¥–µ–ª–∏

–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫–∏ Models, Data.
–î–æ–±–∞–≤—å—Ç–µ –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Film, Ticket, User).
–ü—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏ User:

```csharp
// Models/User.cs
public class User
{
    public int Id { get; set; }
    public string Login { get; set; }
    public string Password { get; set; }
    public string Role { get; set; } // "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", "–ë–∏–ª–µ—Ç–µ—Ä", "–ì–æ—Å—Ç—å"
}
```

5.1.3. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫–∏ Films –∏ Tickets —Å Razor-—Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ CRUD

```bash
dotnet aspnet-codegenerator razorpage -m Film -dc ApplicationDbContext -udl -outDir Pages/Films --referenceScriptLibraries
dotnet aspnet-codegenerator razorpage -m Ticket -dc ApplicationDbContext -udl -outDir Pages/Tickets --referenceScriptLibraries
```

5.1.4. –ò–∑–º–µ–Ω–∏—Ç—å –º–µ–Ω—é –≤ _Layout.cshtml:

```html
<li class="nav-item">
    <a class="nav-link text-dark" asp-page="/Films/Index">–§–∏–ª—å–º—ã</a>
</li>
<li class="nav-item">
    <a class="nav-link text-dark" asp-page="/Tickets/Index">–ë–∏–ª–µ—Ç—ã</a>
</li>
```

---

‚úÖ –ó–∞–¥–∞–Ω–∏–µ 5.2 ‚Äì –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

5.2.1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É Login.cshtml:

```bash
dotnet aspnet-codegenerator razorpage -m User -dc ApplicationDbContext -udl -outDir Pages --referenceScriptLibraries
```

–ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –≤ Login.cshtml –∏ —É–ø—Ä–æ—Å—Ç–∏—Ç–µ —Ñ–æ—Ä–º—É.

5.2.2. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É Login.cshtml:

```html
<form method="post" asp-page-handler="Login">
    <input asp-for="User.Login" />
    <input asp-for="User.Password" type="password" />
    <button type="submit">–í–æ–π—Ç–∏</button>
</form>

<form method="post" asp-page-handler="Guest">
    <button type="submit">–í–æ–π—Ç–∏ –∫–∞–∫ –≥–æ—Å—Ç—å</button>
</form>
```

5.2.3. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ Login.cshtml.cs:

```csharp
public async Task<IActionResult> OnPostLoginAsync()
{
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    // –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å–µ—Å—Å–∏–∏
    return RedirectToPage("/Films/Index");
}

public IActionResult OnPostGuest()
{
    HttpContext.Session.SetString("Role", "–ì–æ—Å—Ç—å");
    return RedirectToPage("/Films/Index");
}
```

---

‚úÖ –ó–∞–¥–∞–Ω–∏–µ 5.3 ‚Äì –†–∞–±–æ—Ç–∞ —Å —Å–µ—Å—Å–∏—è–º–∏

5.3.1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–µ—Å—Å–∏–π –≤ Program.cs:

```csharp
builder.Services.AddSession();
builder.Services.AddHttpContextAccessor();
...
app.UseSession();
```

5.3.2‚Äì5.3.4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞:

```csharp
// –í –º–µ—Ç–æ–¥–µ OnPostGuest
HttpContext.Session.SetString("Role", "–ì–æ—Å—Ç—å");

// –í –º–µ—Ç–æ–¥–µ OnPostLogin
var user = await _context.Users.FirstOrDefaultAsync(u => u.Login == User.Login);
if (user != null && user.Password == User.Password)
{
    HttpContext.Session.SetString("Role", user.Role);
    HttpContext.Session.SetString("Login", user.Login);
    return RedirectToPage("/Films/Index");
}

// –í—ã—Ö–æ–¥
public IActionResult OnGetLogout()
{
    HttpContext.Session.Clear();
    return RedirectToPage("/Index");
}
```

5.3.5. –ò–∑–º–µ–Ω–∏—Ç—å –º–µ–Ω—é –≤ _Layout.cshtml:

```html
@{
    var login = Context.Session.GetString("Login");
    var role = Context.Session.GetString("Role");
}

@if (!string.IsNullOrEmpty(login))
{
    <span>@login (@role)</span>
    <a asp-page="/Login" asp-page-handler="logout">–í—ã–π—Ç–∏</a>
}
else
{
    <a asp-page="/Login">–í–æ–π—Ç–∏</a>
}
```

---

‚úÖ –ó–∞–¥–∞–Ω–∏–µ 5.4 ‚Äì –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

5.4.1‚Äì5.4.3. –°–æ–∑–¥–∞—Ç—å AuthPageModel.cs:

```csharp
public class AuthPageModel : PageModel
{
    public string UserRole => HttpContext.Session.GetString("Role");
    public bool IsAdmin => UserRole == "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä";
    public bool IsTicketier => UserRole == "–ë–∏–ª–µ—Ç–µ—Ä";

    protected IActionResult HasRole()
    {
        if (string.IsNullOrEmpty(UserRole))
            return RedirectToPage("/Login");
        return null;
    }

    protected IActionResult IsInRole(string role)
    {
        if (UserRole != role)
            return RedirectToPage("/Login");
        return null;
    }

    protected IActionResult CanEdit()
    {
        if (!IsAdmin)
            return RedirectToPage("/Login");
        return null;
    }
}
```

5.4.4‚Äì5.4.5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö:

```csharp
public class TicketsIndexModel : AuthPageModel
{
    public async Task<IActionResult> OnGetAsync()
    {
        if (HasRole() is IActionResult result) return result;
        // –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏ –±–∏–ª–µ—Ç–µ—Ä
        if (!IsAdmin && !IsTicketier) return RedirectToPage("/Login");
        return Page();
    }
}
```

---

‚úÖ –ó–∞–¥–∞–Ω–∏–µ 5.5 ‚Äì –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ç–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏

–í Pages/Films/Index.cshtml:

```html
@if (Model.IsAdmin)
{
    <a asp-page="./Edit" asp-route-id="@item.Id">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
}
```

---

üìå –û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–¥–ª—è –æ—Ç—á–µ—Ç–∞):

1. –°–µ—Å—Å–∏—è ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
2. –ö—É–∫–∏ ‚Äî –Ω–µ–±–æ–ª—å—à–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ö—Ä–∞–Ω—è—â–∏–µ—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º.
3. –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ —Å–µ—Å—Å–∏–∏ ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20 –º–∏–Ω—É—Ç, –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å. –ö—É–∫–∏ –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Å—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è.
4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–µ—Å—Å–∏–π:
   ```csharp
   builder.Services.AddSession();
   app.UseSession();
   ```

---

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —è –º–æ–≥—É –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –≤ –≤–∏–¥–µ –∞—Ä—Ö–∏–≤–∞ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞. –ù—É–∂–Ω–æ –ª–∏ —ç—Ç–æ?
