Я помогу вам выполнить задания из практической работы по порядку. Для этого мне понадобятся структуры таблиц вашей базы данных. Предположу типовую структуру для кинотеатра:

Предполагаемые таблицы:

· Посетители (ID_посетителя, Имя, Телефон, ...)
· Фильмы (ID_фильма, Название, Длительность_мин, ...)
· Жанры (ID_жанра, Название_жанра)
· Фильмы_Жанры (ID_фильма, ID_жанра)
· Кинотеатры (ID_кинотеатра, Название)
· Залы (ID_зала, ID_кинотеатра, Номер_зала, Ряды, Места_в_ряду)
· Сеансы (ID_сеанса, ID_фильма, ID_зала, Время_начала, ...)
· Билеты (ID_билета, ID_сеанса, ID_посетителя, Ряд, Место, ...)

Теперь выполним задания:

5.1 Скалярная функция - количество накопленных баллов (минут)

```sql
CREATE FUNCTION dbo.ПолучитьНакопленныеБаллы
(
    @ID_посетителя INT
)
RETURNS INT
AS
BEGIN
    DECLARE @СуммаБаллов INT
    
    SELECT @СуммаБаллов = ISNULL(SUM(ф.Длительность_мин), 0)
    FROM Билеты б
    INNER JOIN Сеансы с ON б.ID_сеанса = с.ID_сеанса
    INNER JOIN Фильмы ф ON с.ID_фильма = ф.ID_фильма
    WHERE б.ID_посетителя = @ID_посетителя
    
    RETURN @СуммаБаллов
END
GO

-- Тестирование функции
SELECT 
    ID_посетителя,
    Имя,
    dbo.ПолучитьНакопленныеБаллы(ID_посетителя) AS Накопленные_баллы
FROM Посетители
```

5.2 Табличная функция - фильмы по жанру

```sql
CREATE FUNCTION dbo.ПолучитьФильмыПоЖанру
(
    @НазваниеЖанра NVARCHAR(100)
)
RETURNS TABLE
AS
RETURN
(
    SELECT 
        ф.ID_фильма,
        ф.Название AS Название_фильма,
        STRING_AGG(ж.Название, ', ') AS Список_жанров
    FROM Фильмы ф
    INNER JOIN Фильмы_Жанры фж ON ф.ID_фильма = фж.ID_фильма
    INNER JOIN Жанры ж ON фж.ID_жанра = ж.ID_жанра
    WHERE ж.Название = @НазваниеЖанра
    GROUP BY ф.ID_фильма, ф.Название
)
GO

-- Тестирование функции
SELECT * FROM dbo.ПолучитьФильмыПоЖанру('Комедия')
```

5.3 Хранимая процедура - добавление билета

```sql
CREATE PROCEDURE dbo.ДобавитьБилет
    @НомерТелефона NVARCHAR(20),
    @КодСеанса INT,
    @Ряд INT,
    @Место INT,
    @НомерБилета INT OUTPUT
AS
BEGIN
    DECLARE @ID_посетителя INT
    
    -- Находим ID посетителя по номеру телефона
    SELECT @ID_посетителя = ID_посетителя 
    FROM Посетители 
    WHERE Телефон = @НомерТелефона
    
    IF @ID_посетителя IS NULL
    BEGIN
        -- Если посетитель не найден, создаем нового
        INSERT INTO Посетители (Телефон)
        VALUES (@НомерТелефона)
        
        SET @ID_посетителя = SCOPE_IDENTITY()
    END
    
    -- Добавляем билет
    INSERT INTO Билеты (ID_сеанса, ID_посетителя, Ряд, Место)
    VALUES (@КодСеанса, @ID_посетителя, @Ряд, @Место)
    
    SET @НомерБилета = SCOPE_IDENTITY()
END
GO

-- Тестирование процедуры
DECLARE @НовыйБилет INT
EXEC dbo.ДобавитьБилет 
    @НомерТелефона = '+375291234567',
    @КодСеанса = 1,
    @Ряд = 3,
    @Место = 5,
    @НомерБилета = @НовыйБилет OUTPUT
    
SELECT @НовыйБилет AS Новый_номер_билета
```

5.4 Хранимая процедура - добавление/обновление кинозала

```sql
CREATE PROCEDURE dbo.ДобавитьИлиОбновитьЗал
    @Кинотеатр NVARCHAR(100) = 'Титан-Арена',
    @НомерЗала INT,
    @КоличествоРядов INT,
    @МестВРяду INT
AS
BEGIN
    IF EXISTS (SELECT 1 FROM Залы з
               INNER JOIN Кинотеатры к ON з.ID_кинотеатра = к.ID_кинотеатра
               WHERE к.Название = @Кинотеатр AND з.Номер_зала = @НомерЗала)
    BEGIN
        -- Обновляем существующий зал
        UPDATE з
        SET з.Ряды = @КоличествоРядов,
            з.Места_в_ряду = @МестВРяду
        FROM Залы з
        INNER JOIN Кинотеатры к ON з.ID_кинотеатра = к.ID_кинотеатра
        WHERE к.Название = @Кинотеатр AND з.Номер_зала = @НомерЗала
    END
    ELSE
    BEGIN
        -- Добавляем новый зал
        DECLARE @ID_кинотеатра INT
        
        SELECT @ID_кинотеатра = ID_кинотеатра 
        FROM Кинотеатры 
        WHERE Название = @Кинотеатр
        
        IF @ID_кинотеатра IS NOT NULL
        BEGIN
            INSERT INTO Залы (ID_кинотеатра, Номер_зала, Ряды, Места_в_ряду)
            VALUES (@ID_кинотеатра, @НомерЗала, @КоличествоРядов, @МестВРяду)
        END
    END
END
GO

-- Тестирование процедуры
EXEC dbo.ДобавитьИлиОбновитьЗал 
    @Кинотеатр = 'Титан-Арена',
    @НомерЗала = 5,
    @КоличествоРядов = 10,
    @МестВРяду = 15
```

5.5 Табличная функция - фильмы кинотеатра на сегодня

```sql
CREATE FUNCTION dbo.ПолучитьФильмыКинотеатраНаСегодня
(
    @НазваниеКинотеатра NVARCHAR(100)
)
RETURNS TABLE
AS
RETURN
(
    SELECT 
        ф.ID_фильма,
        ф.Название AS Название_фильма,
        с.Время_начала,
        з.Номер_зала
    FROM Сеансы с
    INNER JOIN Фильмы ф ON с.ID_фильма = ф.ID_фильма
    INNER JOIN Залы з ON с.ID_зала = з.ID_зала
    INNER JOIN Кинотеатры к ON з.ID_кинотеатра = к.ID_кинотеатра
    WHERE к.Название = @НазваниеКинотеатра
    AND CAST(с.Время_начала AS DATE) = CAST(GETDATE() AS DATE)
)
GO

-- Тестирование функции
SELECT * FROM dbo.ПолучитьФильмыКинотеатраНаСегодня('Титан-Арена')
```

Примечание: Если структура ваших таблиц отличается от предполагаемой, скорректируйте код соответствующим образом. Также убедитесь, что у вас есть необходимые права для создания функций и процедур в базе данных.
